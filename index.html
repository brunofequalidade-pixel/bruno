<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscri√ß√µes - Campeonato de Sinuca</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 400px;
        }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-6">

    <div class="w-full max-w-md bg-white rounded-2xl shadow-xl p-6">
        <h1 class="text-2xl font-bold mb-2 text-gray-900">Inscri√ß√µes - Campeonato de Sinuca</h1>
        <p class="text-sm text-gray-600 mb-4">Gerencie as inscri√ß√µes para o campeonato.</p>

        <div class="flex justify-between items-center mb-4 border-b pb-4">
            <h2 class="text-lg font-semibold text-gray-800">Participantes</h2>
            <button id="toggleButton" class="px-4 py-2 rounded-xl bg-indigo-600 text-white font-semibold shadow-md hover:bg-indigo-700 transition duration-300 ease-in-out">
                Nova Inscri√ß√£o
            </button>
        </div>

        <!-- Formul√°rio -->
        <div id="formSection" class="hidden">
            <form id="registrationForm" class="space-y-4">
                <input id="matriculaInput" type="text" placeholder="N¬∞ da Matr√≠cula*" required class="w-full p-3 border border-gray-300 rounded-xl">
                <input id="nomeInput" type="text" placeholder="Nome completo*" required class="w-full p-3 border border-gray-300 rounded-xl">
                <input id="setorInput" type="text" placeholder="Setor*" required class="w-full p-3 border border-gray-300 rounded-xl">
                
                <div class="flex flex-col sm:flex-row items-center gap-4">
                    <input id="fotoInput" type="file" accept="image/*" required class="w-full p-3 border border-gray-300 rounded-xl">
                    <img id="previewFoto" class="hidden w-16 h-16 object-cover rounded-full border-2 border-indigo-500" alt="Pr√©-visualiza√ß√£o da foto">
                </div>
                
                <div class="flex flex-col sm:flex-row gap-2">
                    <button type="submit" class="flex-1 px-4 py-2 rounded-xl bg-indigo-600 text-white font-semibold shadow-md hover:bg-indigo-700">
                        Enviar inscri√ß√£o
                    </button>
                    <button type="button" id="clearFormBtn" class="flex-1 px-4 py-2 rounded-xl border border-gray-300 text-gray-700">
                        Limpar
                    </button>
                    <button type="button" id="backBtn" class="flex-1 px-4 py-2 rounded-xl border border-gray-300 text-gray-700">
                        Voltar
                    </button>
                </div>

                <div id="messageArea" class="p-3 rounded-xl hidden"></div>
            </form>
            <hr class="my-6">
        </div>

        <!-- Lista de Participantes -->
        <div id="listSection" class="mt-4">
            <div id="participantList" class="max-h-80 overflow-y-auto border border-gray-200 rounded-xl p-3"></div>
            <p id="loadingMessage" class="text-sm text-gray-500 p-2 text-center">Carregando participantes...</p>
        </div>
    </div>
    
    <!-- Modal -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <p class="text-lg font-semibold mb-2 text-gray-800">Digite a senha para apagar o participante.</p>
            <input type="password" id="passwordInput" placeholder="Senha" class="w-full p-3 border border-gray-300 rounded-xl mb-4">
            <div id="modalError" class="text-sm text-red-600 mb-4 hidden">Senha incorreta. Tente novamente.</div>
            <div class="flex justify-center gap-4">
                <button id="confirmBtn" class="px-6 py-2 rounded-xl bg-red-600 text-white">Confirmar</button>
                <button id="cancelBtn" class="px-6 py-2 rounded-xl border border-gray-300 text-gray-700">Cancelar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // üîπ Cole aqui suas chaves do Firebase
        const firebaseConfig = {
          apiKey: "SUA_CHAVE",
          authDomain: "SEU_PROJETO.firebaseapp.com",
          projectId: "SEU_PROJETO",
          storageBucket: "SEU_PROJETO.appspot.com",
          messagingSenderId: "SEU_ID",
          appId: "SEU_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        await signInAnonymously(auth);

        // DOM
        const formSection = document.getElementById('formSection');
        const listSection = document.getElementById('listSection');
        const toggleButton = document.getElementById('toggleButton');
        const registrationForm = document.getElementById('registrationForm');
        const matriculaInput = document.getElementById('matriculaInput');
        const nomeInput = document.getElementById('nomeInput');
        const setorInput = document.getElementById('setorInput');
        const fotoInput = document.getElementById('fotoInput');
        const previewFoto = document.getElementById('previewFoto');
        const messageArea = document.getElementById('messageArea');
        const participantList = document.getElementById('participantList');
        const clearFormBtn = document.getElementById('clearFormBtn');
        const backBtn = document.getElementById('backBtn');
        const modal = document.getElementById('confirmationModal');
        const passwordInput = document.getElementById('passwordInput');
        const modalError = document.getElementById('modalError');
        const confirmBtn = document.getElementById('confirmBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const loadingMessage = document.getElementById('loadingMessage');

        let docIdToDelete = null;

        // üîπ Carregar participantes
        function loadEntries() {
            const participantsCollection = collection(db, "participantes");
            onSnapshot(participantsCollection, (querySnapshot) => {
                let entries = [];
                querySnapshot.forEach((doc) => {
                    entries.push({ id: doc.id, ...doc.data() });
                });
                entries.sort((a, b) => b.criado_em.localeCompare(a.criado_em));
                renderParticipants(entries);
                loadingMessage.classList.add('hidden');
            });
        }

        // üîπ Salvar novo participante
        async function saveEntry(newEntry) {
            try {
                await addDoc(collection(db, "participantes"), newEntry);
                showMessage('success', "Inscri√ß√£o realizada com sucesso!");
            } catch (e) {
                showMessage('error', "Erro ao salvar inscri√ß√£o.");
            }
        }

        // üîπ Apagar participante
        async function deleteParticipant(docId) {
            try {
                await deleteDoc(doc(db, "participantes", docId));
                showMessage('info', "Participante apagado.");
            } catch {
                showMessage('error', "Erro ao apagar participante.");
            }
        }

        // üîπ Renderizar lista
        function renderParticipants(entries) {
            if (entries.length === 0) {
                participantList.innerHTML = `<p class="text-sm text-gray-500 p-2">Nenhum participante ainda.</p>`;
                return;
            }
            participantList.innerHTML = entries.map(r => `
                <li class="flex items-center justify-between gap-3 p-3 rounded-lg hover:bg-gray-50">
                    <div class="flex items-center gap-3">
                        ${r.foto ? `<img src="${r.foto}" class="w-12 h-12 rounded-full border" />` : ''}
                        <div>
                            <span class="font-semibold">${r.nome}</span>
                            <span class="text-xs text-gray-500">Matr√≠cula: ${r.matricula} | Setor: ${r.setor}</span>
                        </div>
                    </div>
                    <button class="delete-btn px-3 py-1 bg-red-500 text-white rounded" data-id="${r.id}">Apagar</button>
                </li>
            `).join('');
        }

        // üîπ Mensagens
        function showMessage(type, text) {
            messageArea.textContent = text;
            messageArea.classList.remove('hidden', 'bg-red-100', 'bg-green-100', 'bg-blue-100');
            if (type === 'error') messageArea.classList.add('bg-red-100');
            if (type === 'success') messageArea.classList.add('bg-green-100');
            if (type === 'info') messageArea.classList.add('bg-blue-100');
        }

        // Eventos
        toggleButton.addEventListener('click', () => {
            formSection.classList.toggle('hidden');
            listSection.classList.toggle('hidden');
            toggleButton.textContent = formSection.classList.contains('hidden') ? "Nova Inscri√ß√£o" : "Ver Participantes";
        });

        backBtn.addEventListener('click', () => {
            formSection.classList.add('hidden');
            listSection.classList.remove('hidden');
            toggleButton.textContent = "Nova Inscri√ß√£o";
        });

        fotoInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    previewFoto.src = ev.target.result;
                    previewFoto.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        });

        registrationForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const newEntry = {
                matricula: matriculaInput.value.trim(),
                nome: nomeInput.value.trim(),
                setor: setorInput.value.trim(),
                foto: previewFoto.src,
                criado_em: new Date().toISOString()
            };
            if (!newEntry.matricula || !newEntry.nome || !newEntry.setor || !newEntry.foto) {
                showMessage('error', "Preencha todos os campos.");
                return;
            }
            saveEntry(newEntry);
            registrationForm.reset();
            previewFoto.src = "";
            previewFoto.classList.add('hidden');
            formSection.classList.add('hidden');
            listSection.classList.remove('hidden');
            toggleButton.textContent = "Nova Inscri√ß√£o";
        });

        clearFormBtn.addEventListener('click', () => {
            registrationForm.reset();
            previewFoto.classList.add('hidden');
        });

        participantList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-btn')) {
                docIdToDelete = e.target.getAttribute('data-id');
                modal.style.display = 'flex';
                passwordInput.value = '';
                modalError.classList.add('hidden');
            }
        });

        confirmBtn.addEventListener('click', () => {
            if (passwordInput.value === "dpsp123") {
                deleteParticipant(docIdToDelete);
                modal.style.display = 'none';
            } else {
                modalError.classList.remove('hidden');
            }
        });

        cancelBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // Inicializa√ß√£o
        loadEntries();
    </script>
</body>
</html>
